---
# defaults file for roles/vsphere-lab-vyos
vyos_fqdn: "vyos.{{ lab_domain }}"

vyos_save_configuration: yes

vyos_interfaces: 
  - ipv4: []
    description: Provision Interface
    enabled: true
    mtu: 1500
  - ipv4: 
      - address: "{{ external_ip }}/{{ external_cidr}}"
    description: External Network
    enabled: true
    mtu: 1500
  - ipv4: 
      - address: 172.16.100.1/24
    description: Internal Network
    enabled: true
    mtu: 9000
    
vyos_vlan_interface: eth2

vyos_external_networks: "{{ route_networks.split(',') }}"

vyos_dhcp_networks: []

# TODO improve NAT rules creations logic (too hardcoded)
vyos_nat_rules:
  destination:
    - description: "Port Forward: SSH to Infra Server {{ infra_servers.0.hostname }} {{ infra_servers.0.ip }}"
      destination: 
        port: "{{ infra_servers.0.external_port }}"
      inbound_interface: eth1
      protocol: tcp
      translation:
        address: "{{ infra_servers.0.ip }}"
        port: 22
    - description: "Port Forward: SSH to Infra Server {{ infra_servers.1.hostname }} {{ infra_servers.1.ip }}"
      destination: 
        port: "{{ infra_servers.1.external_port }}"
      inbound_interface: eth1
      protocol: tcp
      translation:
        address: "{{ infra_servers.1.ip }}"
        port: 22
    - description: "Port Forward: SSH to Infra Server {{ infra_servers.2.hostname }} {{ infra_servers.2.ip }}"
      destination: 
        port: "{{ infra_servers.2.external_port }}"
      inbound_interface: eth1
      protocol: tcp
      translation:
        address: "{{ infra_servers.2.ip }}"
        port: 22
    - description: "Port Forward: SSH to Remote Desktop Server {{ rdp_servers.0.hostname }} {{ rdp_servers.0.ip }}"
      destination: 
        port: "{{ rdp_servers.0.external_port }}"
      inbound_interface: eth1
      protocol: tcp
      translation:
        address: "{{ rdp_servers.0.ip }}"
        port: 22
    - description: "Port Forward: esxi server 1 HTTPS {{ esxi_servers.0.ip }}"
      destination: 
        port: 11443
      inbound_interface: eth1
      protocol: tcp
      translation:
        address: "{{ esxi_servers.0.ip }}"
        port: 443
    - description: "Port Forward: esxi server 2 HTTPS {{ esxi_servers.1.ip }}"
      destination: 
        port: 12443
      inbound_interface: eth1
      protocol: tcp
      translation:
        address: "{{ esxi_servers.1.ip }}"
        port: 443
    - description: "Port Forward: esxi server 3 HTTPS {{ esxi_servers.2.ip }}"
      destination: 
        port: 13443
      inbound_interface: eth1
      protocol: tcp
      translation:
        address: "{{ esxi_servers.2.ip }}"
        port: 443
    - description: "Port Forward: esxi server 4 HTTPS {{ esxi_servers.3.ip }}"
      destination: 
        port: 14443
      inbound_interface: eth1
      protocol: tcp
      translation:
        address: "{{ esxi_servers.3.ip }}"
        port: 443
    - description: "Port Forward: esxi server 5 HTTPS {{ esxi_servers.4.ip }}"
      destination: 
        port: 15443
      inbound_interface: eth1
      protocol: tcp
      translation:
        address: "{{ esxi_servers.4.ip }}"
        port: 443
    - description: "Port Forward: vcenter server HTTPS {{ vcenter_server.ip }}"
      destination: 
        port: 443
      inbound_interface: eth1
      protocol: tcp
      translation:
        address: "{{ vcenter_server.ip }}"
        port: 443
    - description: "Port Forward: remote desktop access {{ rdp_servers.0.ip }}"
      destination: 
        port: 3389
      inbound_interface: eth1
      protocol: tcp
      translation:
        address: "{{ rdp_servers.0.ip }}"
        port: 3389
  source:
    - description: "Masquerade internal Network"
      source:
        address: 172.16.0.0/16
      translation:
        address: masquerade
      outbound_interface: eth1